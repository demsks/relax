function fixShortcut(a){return isMac?a=a.replace("Ctrl","Cmd"):a=a.replace("Cmd","Ctrl"),a}function createIcon(a,b){b=b||{};var c=document.createElement("a"),d=b.shortcut||shortcuts[a];return d&&(d=fixShortcut(d),c.title=d,c.title=c.title.replace("Cmd","⌘"),isMac&&(c.title=c.title.replace("Alt","⌥"))),c.className=b.className||"icon-"+a,c}function createSep(){return el=document.createElement("i"),el.className="separator",el.innerHTML="|",el}function getState(a,b){b=b||a.getCursor("start");var c=a.getTokenAt(b);if(!c.type)return{};var d=c.type.split(" "),e={},f,g;for(var h=0;h<d.length;h++)f=d[h],f==="strong"?e.bold=!0:f==="variable-2"?(g=a.getLine(b.line),/^\s*\d+\.\s/.test(g)?e["ordered-list"]=!0:e["unordered-list"]=!0):f==="atom"?e.quote=!0:f==="em"&&(e.italic=!0);return e}function toggleFullScreen(a){var b=a.codemirror.getWrapperElement(),c=document,d=c.fullScreen||c.mozFullScreen||c.webkitFullScreen,e=function(){b.requestFullScreen?b.requestFullScreen():b.mozRequestFullScreen?b.mozRequestFullScreen():b.webkitRequestFullScreen&&b.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT)},f=function(){c.cancelFullScreen?c.cancelFullScreen():c.mozCancelFullScreen?c.mozCancelFullScreen():c.webkitCancelFullScreen&&c.webkitCancelFullScreen()};d?f&&f():e()}function toggleBold(a){var b=a.codemirror,c=getState(b),d,e="**",f="**",g=b.getCursor("start"),h=b.getCursor("end");c.bold?(d=b.getLine(g.line),e=d.slice(0,g.ch),f=d.slice(g.ch),e=e.replace(/^(.*)?(\*|\_){2}(\S+.*)?$/,"$1$3"),f=f.replace(/^(.*\S+)?(\*|\_){2}(\s+.*)?$/,"$1$3"),g.ch-=2,h.ch-=2,b.setLine(g.line,e+f)):(d=b.getSelection(),b.replaceSelection(e+d+f),g.ch+=2,h.ch+=2),b.setSelection(g,h),b.focus()}function toggleItalic(a){var b=a.codemirror,c=getState(b),d,e="*",f="*",g=b.getCursor("start"),h=b.getCursor("end");c.italic?(d=b.getLine(g.line),e=d.slice(0,g.ch),f=d.slice(g.ch),e=e.replace(/^(.*)?(\*|\_)(\S+.*)?$/,"$1$3"),f=f.replace(/^(.*\S+)?(\*|\_)(\s+.*)?$/,"$1$3"),g.ch-=1,h.ch-=1,b.setLine(g.line,e+f)):(d=b.getSelection(),b.replaceSelection(e+d+f),g.ch+=1,h.ch+=1),b.setSelection(g,h),b.focus()}function toggleBlockquote(a){var b=a.codemirror;_toggleLine(b,"quote")}function toggleUnOrderedList(a){var b=a.codemirror;_toggleLine(b,"unordered-list")}function toggleOrderedList(a){var b=a.codemirror;_toggleLine(b,"ordered-list")}function drawLink(a){var b=a.codemirror,c=getState(b);_replaceSelection(b,c.link,"[","](http://)")}function drawImage(a){var b=a.codemirror,c=getState(b);_replaceSelection(b,c.image,"![","](http://)")}function undo(a){var b=a.codemirror;b.undo(),b.focus()}function redo(a){var b=a.codemirror;b.redo(),b.focus()}function togglePreview(a){var b=a.toolbar.preview,c=a.constructor.markdown,d=a.codemirror,e=d.getWrapperElement(),f=e.lastChild;/editor-preview/.test(f.className)||(f=document.createElement("div"),f.className="editor-preview",e.appendChild(f)),/editor-preview-active/.test(f.className)?(f.className=f.className.replace(/\s*editor-preview-active\s*/g,""),b.className=b.className.replace(/\s*active\s*/g,"")):(setTimeout(function(){f.className+=" editor-preview-active"},1),b.className+=" active");var g=d.getValue();f.innerHTML=c(g)}function _replaceSelection(a,b,c,d){var e,f=a.getCursor("start"),g=a.getCursor("end");b?(e=a.getLine(f.line),c=e.slice(0,f.ch),d=e.slice(f.ch),a.setLine(f.line,c+d)):(e=a.getSelection(),a.replaceSelection(c+e+d),f.ch+=c.length,g.ch+=c.length),a.setSelection(f,g),a.focus()}function _toggleLine(a,b){var c=getState(a),d=a.getCursor("start"),e=a.getCursor("end"),f={quote:/^(\s*)\>\s+/,"unordered-list":/^(\s*)(\*|\-|\+)\s+/,"ordered-list":/^(\s*)\d+\.\s+/},g={quote:"> ","unordered-list":"* ","ordered-list":"1. "};for(var h=d.line;h<=e.line;h++)(function(d){var e=a.getLine(d);c[b]?e=e.replace(f[b],"$1"):e=g[b]+e,a.setLine(d,e)})(h);a.focus()}function wordCount(a){var b=/[a-zA-Z0-9_\u0392-\u03c9]+|[\u4E00-\u9FFF\u3400-\u4dbf\uf900-\ufaff\u3040-\u309f\uac00-\ud7af]+/g,c=a.match(b),d=0;if(c===null)return d;for(var e=0;e<c.length;e++)c[e].charCodeAt(0)>=19968?d+=c[e].length:d+=1;return d}var isMac=/Mac/.test(navigator.platform),shortcuts={"Cmd-B":toggleBold,"Cmd-I":toggleItalic,"Cmd-K":drawLink,"Cmd-Alt-I":drawImage,"Cmd-'":toggleBlockquote,"Cmd-Alt-L":toggleOrderedList,"Cmd-L":toggleUnOrderedList};